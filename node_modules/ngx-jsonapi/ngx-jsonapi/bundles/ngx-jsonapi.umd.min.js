!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("util"),require("rxjs"),require("dexie"),require("rxjs/operators"),require("rxjs/internal/util/noop"),require("lodash"),require("faker")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common","@angular/common/http","util","rxjs","dexie","rxjs/operators","rxjs/internal/util/noop","lodash","faker"],e):e(t["ngx-jsonapi"]={},t.ng.core,t.common,t.http,t.util,t.rxjs,t.Dexie,t.operators,t.noop,t.lodash,t.faker)}(this,function(t,n,e,s,o,a,i,c,u,r,d){"use strict";i=i&&i.hasOwnProperty("default")?i.default:i;var l,h=(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},function(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=function(i,r){var n,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=r.call(i,a)}catch(t){e=[6,t],o=0}finally{n=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},f=function(){this.number=1,this.total_resources=0,this.size=0,this.resources_per_page=0},v=(g.propagateLoaded=function(t,e){for(var i in t){var r=t[i];r instanceof x&&r.setLoaded(e&&r.builded)}},g);function g(){}var y=(b.prototype.applyParams=function(t,e){if(void 0===e&&(e={}),this.appendPath(t.getPrePath()),e.beforepath&&this.appendPath(e.beforepath),this.appendPath(t.getPath()),e.include&&this.setInclude(e.include),function(t){return void 0!==t.id||void 0!==t.include_get||void 0!==t.include_save}(e)&&e.include_get&&this.setInclude(this.includes.concat(e.include_get)),e.fields&&0<Object.keys(e.fields).length)for(var i in e.fields){var r="fields["+i+"]="+e.fields[i].join(",");this.get_params.push(r)}},b.prototype.appendPath=function(t){""!==t&&this.paths.push(t)},b.prototype.getForCache=function(){return this.paths.join("/")+this.get_params.join("/")},b.prototype.get=function(){var t=this.get_params.slice();return 0<this.includes.length&&t.push("include="+this.includes.join(",")),this.paths.join("/")+(0<t.length?it.injectedServices.rsJsonapiConfig.params_separator+t.join("&"):"")},b.prototype.setInclude=function(t){this.includes=t},b);function b(){this.paths=[],this.includes=[],this.get_params=[]}var m=(_.json_array2resources_array_by_type=function(t){var e={},i={};for(var r in _.json_array2resources_array(t,e),e){var n=e[r];n.type in i||(i[n.type]={}),i[n.type][n.id]=n}return i},_.json2resource=function(t,e){if(_.getService(t.type))return _.procreate(t);n.isDevMode()&&console.warn("`"+t.type+"`","service not found on json2resource().","Use @Autoregister() on service and inject it on component.");var i=new j;return i.id=t.id,i.type=t.type,i},_.getService=function(t){return it.me.getResourceService(t)},_.getServiceOrFail=function(t){return it.me.getResourceServiceOrFail(t)},_.buildIncluded=function(t){return"included"in t&&t.included?_.json_array2resources_array_by_type(t.included):{}},_.procreate=function(t){"type"in t&&"id"in t||console.error("Jsonapi Resource is not correct",t);var e=I.getInstance().getOrCreateResource(t.type,t.id);return e.fill({data:t}),e.is_new=!1,e},_.json_array2resources_array=function(t,e){void 0===e&&(e={});for(var i=0,r=t;i<r.length;i++){var n=r[i],o=_.json2resource(n,!1);e[o.type+"_"+o.id]=o}},_);function _(){}var w=(R.prototype.buildRelationships=function(){for(var t in this.relationships_from){var e=this.relationships_from[t];this.relationships_dest[t]&&null===e.data&&(this.relationships_dest[t].data=null,this.relationships_dest[t].builded=!0,this.relationships_dest[t].is_loading=!1,this.relationships_dest[t].loaded=!0),e.data&&(this.relationships_dest[t]instanceof x?this.__buildRelationshipHasMany(e,t):this.relationships_dest[t]instanceof q&&this.__buildRelationshipHasOne(e,t))}},R.prototype.__buildRelationshipHasMany=function(t,e){if(0===t.data.length)return this.relationships_dest[e]=new x,void(this.relationships_dest[e].builded=!0);this.relationships_dest[e].fill(t)},R.prototype.__buildRelationshipHasOne=function(t,e){if("type"in t.data){if(this.relationships_dest[e].data||(this.relationships_dest[e].data=new j),t.data.id!==this.relationships_dest[e].data.id&&(this.relationships_dest[e].data=new j,this.relationships_dest[e].data.type=t.data.type),this.relationships_dest[e].data.id!==t.data.id||!this.relationships_dest[e].data.attributes||0===Object.keys(this.relationships_dest[e].data.attributes).length){var i=this.__buildRelationship(t.data);i?(this.relationships_dest[e].data=i,this.relationships_dest[e].builded=!0):(this.relationships_dest[e].data.id=t.data.id,this.relationships_dest[e].data.type=t.data.type)}}else this.relationships_dest[e].data=[]},R.prototype.__buildRelationship=function(t){if(t.type in this.included_resources&&t.id in this.included_resources[t.type]){var e=this.included_resources[t.type][t.id];return I.getInstance().setResource(e,!0),e}this.getService(t.type);var i=I.getInstance().getResource(t.type,t.id);if(i)return i},R);function R(t,e,i,r){this.getService=t,this.relationships_from=e,this.relationships_dest=i,this.included_resources=r}var j=(S.prototype.reset=function(){for(var t in this.id="",this.attributes={},this.is_new=!0,this.relationships)this.relationships[t]=this.relationships[t]instanceof x?new x:new q},S.prototype.toObject=function(t){var e,i={},r=[],n=[],o=(t=Object.assign({},F.ParamsResource,t)).include||[];for(var s in t.include_save&&(o=o.concat(t.include_save)),this.relationships){var a=this.relationships[s];if(a instanceof x){a.builded||a.data&&0!==a.data.length?i[s]={data:[]}:delete i[s];for(var c=0,u=a.data;c<u.length;c++){var d=u[c],l={id:d.id,type:d.type};i[s].data.push(l);var h=d.type+"_"+d.id;-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(d.toObject({}).data))}}else{if(null===a.data||void 0===a.data){i[s]={data:a.data};continue}a instanceof q||console.warn(a," is not DocumentCollection or DocumentResource");var p=a.data;if(a.data&&!("id"in a.data)&&0<Object.keys(a.data).length&&console.warn(s+" defined with hasMany:false, but I have a collection"),p.id&&p.type)i[s]={data:{id:p.id,type:p.type}};else if(!a.builded&&!p.id&&!p.type){delete i[s];continue}h=p.type+"_"+p.id,-1===n.indexOf(h)&&o&&-1!==o.indexOf(s)&&(n.push(h),r.push(p.toObject({}).data))}}this.getService()&&this.getService().parseToServer?(e=Object.assign({},this.attributes),this.getService().parseToServer(e)):e=this.attributes;var f={data:{type:this.type,id:this.id,attributes:e,relationships:i}};return this.meta&&(f.data.meta=this.meta),t.meta&&(f.meta=t.meta),0<r.length&&(f.included=r),f},S.prototype.fill=function(t){this.id=t.data.id||"",this.attributes=Object.assign({},this.attributes||{},t.data.attributes),this.is_new=!1;var e=m.getService(t.data.type);if(!this.relationships&&e&&(this.relationships=(new e.resource).relationships),!e)return!1;if(Object.keys(this.attributes).length){var i=m.getService(this.type);i&&"parseFromServer"in i&&i.parseFromServer(this.attributes)}return"cache_last_update"in t.data&&(this.cache_last_update=t.data.cache_last_update),new w(m.getService,t.data.relationships||{},this.relationships,m.buildIncluded(t)).buildRelationships(),!0},S.prototype.addRelationship=function(t,e){var i=this.relationships[e||t.type];i instanceof x?i.replaceOrAdd(t):i.data=t},S.prototype.addRelationships=function(t,e){var i=this;if(0!==t.length){if(!(this.relationships[e]instanceof x))throw new Error("addRelationships require a DocumentCollection (hasMany) relation.");t.forEach(function(t){i.addRelationship(t,e)})}},S.prototype.removeRelationship=function(t,e){if(!(t in this.relationships))return!1;if(!("data"in this.relationships[t]))return!1;var i=this.relationships[t];return i instanceof x?(i.data=i.data.filter(function(t){return t.id!==e}),0===i.data.length&&(i.builded=!0)):i.data=null,!0},S.prototype.hasManyRelated=function(t){return this.relationships[t]&&0<this.relationships[t].data.length},S.prototype.hasOneRelated=function(t){return Boolean(this.relationships[t]&&this.relationships[t].data.type&&""!==this.relationships[t].data.type)},S.prototype.restore=function(t){return void 0===t&&(t={}),t.meta=Object.assign({},t.meta,{restore:!0}),this.save(t)},S.prototype.getService=function(){return m.getServiceOrFail(this.type)},S.prototype.delete=function(){return this.getService().delete(this.id)},S.prototype.save=function(t){var e=this;if(t=Object.assign({},F.ParamsResource,t),this.is_saving||!this.loaded)return a.of({});this.is_saving=!0;var i=new a.Subject,r=this.toObject(t);""===this.id&&delete r.data.id;var n=new y;return n.applyParams(this.getService(),t),this.id&&n.appendPath(this.id),it.exec(n.get(),this.id?"PATCH":"POST",r,!0).subscribe(function(t){e.is_saving=!1,e.id||(I.getInstance().deprecateCollections(n.get()),(new W).deprecateCollection(n.get())),"id"in t.data?(e.id=t.data.id,e.fill(t)):o.isArray(t.data)&&console.warn("Server return a collection when we save()",t.data),i.next(t),i.complete()},function(t){e.is_saving=!1,i.error("data"in t?t.data:t)}),i},S.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},S.prototype.setLoadedAndPropagate=function(t){this.setLoaded(t),v.propagateLoaded(this.relationships,t)},S.prototype.setSource=function(t){this.source=t},S.prototype.setSourceAndPropagate=function(t){for(var e in this.setSource(t),this.relationships){var i=this.relationships[e];i instanceof x&&i.setSource(t)}},S.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},S);function S(){this.id="",this.type="",this.attributes={},this.relationships={},this.links={},this.is_new=!0,this.is_saving=!1,this.is_loading=!1,this.loaded=!0,this.source="new",this.cache_last_update=0,this.ttl=0}function O(){this.builded=!1,this.is_loading=!0,this.loaded=!1,this.source="new",this.cache_last_update=0,this.meta={}}var C,P=(h(D,C=O),D.prototype.trackBy=function(t){return t.id},D.prototype.find=function(t){if("ids"===this.content)return null;for(var e=0;e<this.data.length;e++)if(this.data[e].id===t)return this.data[e];return null},D.prototype.fill=function(t){m.buildIncluded(t),this.page&&t.meta&&(this.page.number=t.meta.page||1,this.page.resources_per_page=t.meta.resources_per_page||null,this.page.size=t.meta.resources_per_page||null,this.page.total_resources=t.meta.total_resources||null);var e={};this.data.length=0,this.builded=t.data&&0===t.data.length;for(var i=0,r=t.data;i<r.length;i++){var n=r[i];try{var o=this.getResourceOrFail(n);o.fill({data:n}),e[n.id]=n.id,this.data.push(o),0<Object.keys(o.attributes).length&&(this.builded=!0)}catch(t){this.content="ids",this.builded=!1,this.data.push({id:n.id,type:n.type})}}for(var s=void 0;s<this.data.length;s++)this.data[s].id in e||delete this.data[s];this.meta=t.meta||{},"cache_last_update"in t&&(this.cache_last_update=t.cache_last_update)},D.prototype.getResourceOrFail=function(t){var e=this.find(t.id);if(null!==e)return e;var i=m.getService(t.type);if(!i)throw n.isDevMode()&&console.warn("The relationship relation_alias? (type "+t.type+") cant be generated because service for this type has not been injected."),new Error("Cant create service for "+t.type);return i.getOrCreateResource(t.id)},D.prototype.replaceOrAdd=function(t){var e=this.find(t.id);null===e?this.data.push(t):e=t},D.prototype.hasMorePages=function(){return!this.page.size||this.page.size<1?null:this.page.size*(this.page.number-1)+this.data.length<this.page.total_resources},D.prototype.setLoaded=function(t){this.is_loading=!t,this.loaded=t},D.prototype.setLoadedAndPropagate=function(e){this.setLoaded(e),"ids"!==this.content&&this.data.forEach(function(t){v.propagateLoaded(t.relationships,e)})},D.prototype.setBuilded=function(t){this.builded=t},D.prototype.setBuildedAndPropagate=function(e){this.setBuilded(e),"ids"!==this.content&&this.data.forEach(function(t){t.setLoaded(e)})},D.prototype.setSource=function(t){this.source=t},D.prototype.setSourceAndPropagate=function(e){this.setSource(e),this.data.forEach(function(t){t instanceof j&&t.setSource(e)})},D.prototype.setCacheLastUpdate=function(t){void 0===t&&(t=Date.now()),this.cache_last_update=t},D.prototype.setCacheLastUpdateAndPropagate=function(e){void 0===e&&(e=Date.now()),this.setCacheLastUpdate(e),this.data.forEach(function(t){t instanceof j&&t.setCacheLastUpdate(e)})},D.prototype.toObject=function(e){return this.builded?{data:this.data.map(function(t){return t.toObject(e).data})}:{data:this.data}},D);function D(){var t=C.apply(this,arguments)||this;return t.data=[],t.page=new f,t.ttl=0,t.content="ids",t}var E,x=(h(A,E=P),A);function A(){var t=E.apply(this,arguments)||this;return t.data=[],t.content="collection",t}var F=(k.newCollection=function(){return new x},k.isObjectLive=function(t,e){return 0<=t&&Date.now()<=e+1e3*t},k.forEach=function(e,i){Object.keys(e).forEach(function(t){i(e[t],t)})},k);function k(){}F.ParamsResource={beforepath:"",ttl:void 0,include:[],fields:{},id:""},F.ParamsCollection={beforepath:"",ttl:void 0,include:[],remotefilter:{},fields:{},smartfilter:{},sort:[],page:new f,store_cache_method:"individual",storage_ttl:0,cachehash:""};var I=(L.getInstance=function(){return L.instance||(L.instance=new L),L.instance},L.prototype.clearCache=function(){this.resources={},this.collections={},L.instance=null},L.prototype.getResource=function(t,e){return this.getKey(t,e)in this.resources?this.resources[this.getKey(t,e)]:null},L.prototype.getResourceOrFail=function(t,e){if(this.getKey(t,e)in this.resources)return this.resources[this.getKey(t,e)];throw new Error("The requested resource does not exist in cache memory")},L.prototype.getKey=function(t,e){return t+"."+e},L.prototype.getOrCreateCollection=function(t){return t in this.collections||(this.collections[t]=new x,this.collections[t].source="new"),this.collections[t]},L.prototype.setCollection=function(t,e){t in this.collections||(this.collections[t]=new x);for(var i=0;i<e.data.length;i++){var r=e.data[i];this.setResource(r,!0)}this.collections[t].data=e.data,this.collections[t].page=e.page,this.collections[t].cache_last_update=e.cache_last_update},L.prototype.getOrCreateResource=function(t,e){var i=this.getResource(t,e);return null!==i||((i=m.getServiceOrFail(t).new()).id=e,this.setResource(i,!1)),i},L.prototype.setResource=function(t,e){void 0===e&&(e=!1),this.getKey(t.type,t.id)in this.resources?this.fillExistentResource(t):this.resources[this.getKey(t.type,t.id)]=t,this.resources[this.getKey(t.type,t.id)].cache_last_update=e?Date.now():0},L.prototype.deprecateCollections=function(t){for(var e in void 0===t&&(t=""),this.collections)e.includes(t)&&(this.collections[e].cache_last_update=0);return!0},L.prototype.removeResource=function(i,r){var t=this.getResource(i,r);if(t){for(var e in F.forEach(this.collections,function(t,e){t.data.splice(t.data.findIndex(function(t){return t.type===i&&t.id===r}),1)}),t.attributes={},t.relationships)null!==t.relationships[e].data&&void 0!==t.relationships[e].data&&(t.relationships[e].data instanceof Array?t.relationships[e].data=[]:t.relationships[e].data instanceof Object&&delete t.relationships[e].data);delete this.resources[this.getKey(i,r)]}},L.prototype.fillExistentResource=function(t){var e=this.getResourceOrFail(t.type,t.id);e.attributes=Object.assign({},e.attributes,t.attributes),e.relationships=e.relationships||t.relationships},L);function L(){this.resources={},this.collections={}}var T,q=(h(J,T=O),J.prototype.fill=function(t){this.builded=!1,this.content="id",null!==t?(this.data||(this.data=I.getInstance().getOrCreateResource(t.data.type,t.data.id)),this.data.fill(t)&&(this.builded=!0,this.content="resource"),this.meta=t.meta||{}):this.data=null},J.prototype.unsetData=function(){this.data=void 0,this.builded=!1},J);function J(){var t=T.apply(this,arguments)||this;return t.data=new j,t.builded=!1,t.content="id",t}var M=function(o,s,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},K=(H.prototype.getElement=function(i,r){return void 0===r&&(r="elements"),M(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return[4,H.db.open()];case 1:return t.sent(),[4,H.db.table(r).get(i)];case 2:if(void 0===(e=t.sent()))throw new Error(i+" not found.");return[2,e]}})})},H.prototype.getElements=function(i,r){return void 0===r&&(r="elements"),M(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:return e={},[4,H.db.table(r).where(":id").anyOf(i).each(function(t){e[t.data.type+"."+t.data.id]=t})];case 1:return t.sent(),[2,i.map(function(t){return e[t]})]}})})},H.prototype.updateElements=function(i,t,r){return void 0===r&&(r="elements"),M(this,void 0,void 0,function(){var e=this;return p(this,function(t){return[2,H.db.open().then(function(){return M(e,void 0,void 0,function(){return p(this,function(t){return""===i?[2,H.db.table(r).clear()]:[2,H.db.table(r).where(":id").startsWith(i).delete().then(function(){})]})})})]})})},H.prototype.saveElements=function(r,n){return void 0===n&&(n="elements"),M(this,void 0,void 0,function(){var e,i;return p(this,function(t){return e=[],i=r.map(function(t){return e.push(t.key),t.content}),[2,H.db.open().then(function(){H.db.table(n).bulkPut(i,e)})]})})},H);function H(){H.db||(H.db=new i("dexie_data_provider")).version(1).stores({collections:"",elements:""})}var B=function(o,s,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var W=(z.prototype.getResource=function(n,o){return void 0===o&&(o=[]),B(this,void 0,void 0,function(){var i,r,e;return p(this,function(t){switch(t.label){case 0:return[4,this.getDataResources([n])];case 1:if(void 0===(i=t.sent().shift()))throw new Error("Resource "+n+" don't found.");return 0===o.length?[2,i]:(r=[],o.forEach(function(t){if(!i||!i.data.relationships||!i.data.relationships[t])throw new Error("We dont have relation_alias on stored data resource");var e=i.data.relationships[t].data;e instanceof Array?e.forEach(function(t){r.push(z.getResourceKey(t))}):e&&"id"in e&&r.push(z.getResourceKey(e))}),[4,this.getDataResources(r)]);case 2:return e=t.sent(),[2,Object.assign({},i,{included:e.map(function(t){return t.data})})]}})})},z.prototype.getCollection=function(s,a){return void 0===a&&(a=[]),B(this,void 0,void 0,function(){var e,r,i,n,o;return p(this,function(t){switch(t.label){case 0:return[4,this.getDataCollection(s)];case 1:return e=t.sent(),[4,this.getDataResources(e.keys)];case 2:return r=t.sent(),i={data:r.map(function(t){return t.data}),cache_last_update:e.updated_at},0===a.length?[2,i]:(n=[],a.forEach(function(i){r.forEach(function(t){if(t.data.relationships&&t.data.relationships[i]){var e=t.data.relationships[i].data;e instanceof Array?e.forEach(function(t){n.push(z.getResourceKey(t))}):"id"in e&&n.push(z.getResourceKey(e))}})}),[4,this.getDataResources(n)]);case 3:return o=t.sent(),[2,Object.assign({},i,{included:o.map(function(t){return t.data})})]}})})},z.prototype.getDataCollection=function(e){return B(this,void 0,void 0,function(){return p(this,function(t){return[2,this.dataProvider.getElement(e,"collections")]})})},z.prototype.getDataResources=function(e){return B(this,void 0,void 0,function(){return p(this,function(t){return[2,this.dataProvider.getElements(e,"elements")]})})},z.prototype.saveCollection=function(t,e,i){void 0===i&&(i=[]),this.dataProvider.saveElements(z.collectionToElement(t,e),"collections"),this.dataProvider.saveElements(z.collectionResourcesToElements(e,i),"elements")},z.prototype.saveResource=function(e,i){return void 0===i&&(i=[]),B(this,void 0,void 0,function(){return p(this,function(t){return[2,this.dataProvider.saveElements(z.toResourceElements(z.getResourceKey(e),e,i),"elements")]})})},z.collectionToElement=function(t,e){var i={key:t,content:{updated_at:Date.now(),keys:[]}};return e.data.forEach(function(t){var e=z.getResourceKey(t);i.content.keys.push(e)}),[i]},z.collectionResourcesToElements=function(t,i){void 0===i&&(i=[]);var r=[];return t.data.forEach(function(t){var e=z.getResourceKey(t);r.push.apply(r,z.toResourceElements(e,t,i))}),r},z.toResourceElements=function(t,i,e){void 0===e&&(e=[]);var r=[{key:t,content:i.toObject()}];return r[0].content.data.cache_last_update=Date.now(),e.forEach(function(t){var e=i.relationships[t];if(e instanceof x)e.data.forEach(function(t){r.push(z.getElement(t))});else if(e instanceof q){if(null===e.data||void 0===e.data)return;r.push(z.getElement(e.data))}}),r},z.getResourceKey=function(t){return t.type+"."+t.id},z.getElement=function(t){return{key:z.getResourceKey(t),content:t.toObject()}},z.prototype.deprecateCollection=function(e){return B(this,void 0,void 0,function(){return p(this,function(t){return[2,this.dataProvider.updateElements(e,{},"collections")]})})},z);function z(){this.dataProvider=new K}function G(t,e){var i=e&&"number"==typeof e?e:t.ttl||0;return Date.now()<t.cache_last_update+1e3*i}function U(t,e,i){var r=i.value;return i.value=function(){var t,e=Array.prototype.slice.call(arguments);try{t="string"==typeof e[0]?e[0]:e[0].type}catch(t){return console.warn("ERROR: First argument of methods decorated with serviceIsRegistered has to be string or Resource."),null}return it.me.getResourceService(t)?r.apply(this,e):(console.warn("ERROR: "+t+" service has not been registered."),null)},i}var N=function(){this.url="http://yourdomain/api/v1/",this.params_separator="?",this.unify_concurrency=!0,this.cache_prerequests=!0,this.cachestore_support=!0,this.parameters={page:{number:"page[number]",size:"page[size]"}}},V=(Q.prototype.exec=function(t,e,i){var r=this,n={body:i||null,headers:new s.HttpHeaders({"Content-Type":"application/vnd.api+json",Accept:"application/vnd.api+json"})};if("get"!==e)return this.http.request(e,this.rsJsonapiConfig.url+t,n).pipe(c.tap(function(){delete r.get_requests[t]}),c.share());if(this.get_requests[t])return this.get_requests[t];var o=this.http.request(e,this.rsJsonapiConfig.url+t,n).pipe(c.tap(function(){delete r.get_requests[t]}),c.share());return this.get_requests[t]=o},Q);function Q(t,e){this.http=t,this.rsJsonapiConfig=e,this.get_requests={}}V.decorators=[{type:n.Injectable}],V.ctorParameters=function(){return[{type:s.HttpClient},{type:N}]};var X=function(o,s,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})};var Y=(Z.prototype.getDataObject=function(r,n){return X(this,void 0,void 0,function(){var e,i;return p(this,function(t){switch(t.label){case 0:return e="collection"===r?"collections":"elements",[4,this.db.open()];case 1:return t.sent(),[4,this.db.table(e).get(r+"."+n)];case 2:if(void 0===(i=t.sent()))throw new Error;return[2,i]}})})},Z.prototype.getDataResources=function(r){return X(this,void 0,void 0,function(){var e,i;return p(this,function(t){switch(t.label){case 0:return e=this.db.table("elements").where(":id").anyOf(r),i={},[4,e.each(function(t){i[t.id]=t})];case 1:return t.sent(),[2,i]}})})},Z.prototype.saveResource=function(e,i,t){var r=this,n=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return X(r,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("elements").put(n,e+"."+i)]})})})},Z.prototype.saveCollection=function(e,t){var i=this,r=Object.assign({cache_last_update:Date.now()},t);this.db.open().then(function(){return X(i,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("collections").put(r,"collection."+e)]})})})},Z.prototype.clearCache=function(){var t=this;this.db.open().then(function(){return X(t,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("elements").toCollection().delete()]})})}),this.db.open().then(function(){return X(t,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("collections").toCollection().delete()]})})})},Z.prototype.deprecateResource=function(e,i){var t=this;this.db.open().then(function(){return X(t,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("elements").where(":id").startsWith(e+"."+i).modify({cache_last_update:0})]})})})},Z.prototype.deprecateCollection=function(e){var t=this;this.db.open().then(function(){return X(t,void 0,void 0,function(){return p(this,function(t){return[2,this.db.table("collections").where(":id").startsWith(e).modify({cache_last_update:0})]})})})},Z.prototype.removeObjectsWithKey=function(t){return X(this,void 0,void 0,function(){return p(this,function(t){return[2]})})},Z.prototype.checkIfIsTimeToClean=function(){},Z.prototype.checkAndDeleteOldElements=function(){},Z);function Z(){this.db=new i("jsonapi_db"),this.db.version(1).stores({collections:"",elements:""}),this.checkIfIsTimeToClean()}var $=function(t,e,i,r){var n,o=arguments.length,s=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,r);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,i,s):n(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s},tt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},et=function(o,s,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},it=(rt.delete=function(t){return rt.exec(t,"DELETE")},rt.get=function(t){return rt.exec(t,"get")},rt.exec=function(t,e,i,r){return void 0===r&&(r=!0),rt.me.refreshLoadings(1),rt.injectedServices.JsonapiHttp.exec(t,e,i).pipe(c.tap(function(){return rt.me.refreshLoadings(-1)}),c.catchError(function(t){return t=t.error||t,rt.me.refreshLoadings(-1),t.status<=0?!rt.me.loadingsOffline(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsOffline for catch it) error =>",t):r&&!rt.me.loadingsError(t)&&n.isDevMode()&&console.warn("Jsonapi.Http.exec (use JsonapiCore.loadingsError for catch it) error =>",t),a.throwError(t)}))},rt.prototype.registerService=function(t){return!(t.type in this.resourceServices)&&(this.resourceServices[t.type]=t)},rt.prototype.getResourceService=function(t){return this.resourceServices[t]},rt.prototype.getResourceServiceOrFail=function(t){var e=this.resourceServices[t];if(!e)throw new Error("The requested service with type "+t+" has not been registered, please use register() method or @Autoregister() decorator");return e},rt.removeCachedResource=function(t,e){I.getInstance().removeResource(t,e)},rt.setCachedResource=function(t){I.getInstance().setResource(t,!0)},rt.deprecateCachedCollections=function(t){var e=rt.me.getResourceServiceOrFail(t),i=new y;i.applyParams(e),I.getInstance().deprecateCollections(i.getForCache())},rt.prototype.refreshLoadings=function(t){this.loadingsCounter+=t,0===this.loadingsCounter?this.loadingsDone():1===this.loadingsCounter&&this.loadingsStart()},rt.prototype.clearCache=function(){return et(this,void 0,void 0,function(){return p(this,function(t){return rt.injectedServices.JsonapiStoreService.clearCache(),I.getInstance().clearCache(),[2,(new W).deprecateCollection("").then(function(){return!0})]})})},rt.prototype.duplicateResource=function(i){for(var r=this,n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var o=this.getResourceServiceOrFail(i.type).new();function e(e){var t=i.relationships[e];if(!t.data)return o.relationships[e]=i.relationships[e],"continue";"id"in t.data?-1<n.indexOf(e)?o.addRelationship(s.duplicateResource(t.data),e):o.addRelationship(t.data,e):-1<n.indexOf(e)?t.data.forEach(function(t){o.addRelationship(r.duplicateResource(t),e)}):o.addRelationships(t.data,e)}o.id="new_"+Math.floor(1e4*Math.random()).toString(),o.attributes=Object.assign({},o.attributes,i.attributes);var s=this;for(var a in i.relationships)e(a);return o},rt);function rt(t,e,i){for(var r in this.loadingsCounter=0,this.loadingsStart=u.noop,this.loadingsDone=u.noop,this.loadingsError=u.noop,this.loadingsOffline=u.noop,this.resourceServices={},this.config=new N,this.config)this.config[r]=void 0!==t[r]?t[r]:this.config[r];rt.me=this,rt.injectedServices={JsonapiStoreService:e,JsonapiHttp:i,rsJsonapiConfig:this.config}}it.decorators=[{type:n.Injectable}],it.ctorParameters=function(){return[{type:N,decorators:[{type:n.Optional}]},{type:Y},{type:V}]},$([U,tt("design:type",Function),tt("design:paramtypes",[String,String]),tt("design:returntype",void 0)],it,"removeCachedResource",null),$([U,tt("design:type",Function),tt("design:paramtypes",[j]),tt("design:returntype",void 0)],it,"setCachedResource",null),$([U,tt("design:type",Function),tt("design:paramtypes",[String]),tt("design:returntype",void 0)],it,"deprecateCachedCollections",null);var nt=(ot.forRoot=function(t){return{ngModule:ot,providers:[{provide:N,useValue:t}]}},ot);function ot(t,e){if(t)throw new Error("NgxJsonapiModule is already loaded. Import it in the AppModule only")}nt.decorators=[{type:n.NgModule,args:[{imports:[e.CommonModule],exports:[s.HttpClientModule],providers:[it,Y,N,V]}]}],nt.ctorParameters=function(){return[{type:nt,decorators:[{type:n.Optional},{type:n.SkipSelf}]},{type:it}]};var st=(at.prototype.toparams=function(t){var i=this,r="";return F.forEach(t,function(t,e){r+=i.toparamsarray(t,"&"+e)}),r.slice(1)},at.prototype.toparamsarray=function(t,i){var r=this,n="";return Array.isArray(t)||o.isObject(t)?F.forEach(t,function(t,e){n+=r.toparamsarray(t,i+"["+e+"]")}):n+=i+"="+t,n},at);function at(){}var ct,ut=(h(dt,ct=y),dt.prototype.applyParams=function(t,e){void 0===e&&(e={}),ct.prototype.applyParams.call(this,t,e);var i=new st;e.remotefilter&&0<Object.keys(e.remotefilter).length&&(t.parseToServer&&t.parseToServer(e.remotefilter),this.addParam(i.toparams({filter:e.remotefilter}))),e.page&&(1<e.page.number&&this.addParam(this.getPageConfig().number+"="+e.page.number),e.page.size&&this.addParam(this.getPageConfig().size+"="+e.page.size)),e.sort&&e.sort.length&&this.addParam("sort="+e.sort.join(","))},dt.prototype.getPageConfig=function(){return it.injectedServices.rsJsonapiConfig.parameters&&it.injectedServices.rsJsonapiConfig.parameters.page||{number:"number",size:"size"}},dt.prototype.addParam=function(t){this.get_params.push(t)},dt);function dt(){return null!==ct&&ct.apply(this,arguments)||this}var lt=(ht.prototype.getResourceObject=function(){return this.resource_object},ht.prototype.removeDuplicatedIncludes=function(){if(!this.resource_object.included||!this.parent_resource_object.included)return this;var t=this.parent_resource_object.included;return this.resource_object.included=this.resource_object.included.filter(function(e){return!r.isEqual(e,t.find(function(t){return t.id===e.id}))}),this.resource_object.included=this.resource_object.included.map(function(e){return t.find(function(t){return t.id===e.id})?new ht(e,t.find(function(t){return t.id===e.id})).getResourceObject().data:e}),this},ht.prototype.removeDuplicatedRelationships=function(){if(!this.resource_object.data.relationships||!this.parent_resource_object.data.relationships)return this;for(var t in this.resource_object.data.relationships)r.isEqual(this.resource_object.data.relationships[t],this.parent_resource_object.data.relationships[t])&&delete this.resource_object.data.relationships[t];return this},ht.prototype.removeDuplicatedAttributes=function(){if(!this.resource_object.data.attributes||!this.parent_resource_object.data.attributes)return this;for(var t in this.resource_object.data.attributes)this.resource_object.data.attributes[t]===this.parent_resource_object.data.attributes[t]&&delete this.resource_object.data.attributes[t];return this},ht);function ht(t,e,i){this.parent_resource_object=e instanceof j?e.toObject(i):{data:e},!function(t){return t&&t.toObject&&"function"==typeof t.toObject&&t.superToObject&&"function"==typeof t.superToObject}(t)?this.resource_object={data:t}:this.resource_object=t.superToObject(i),this.removeDuplicatedAttributes(),this.removeDuplicatedRelationships(),this.removeDuplicatedIncludes()}var pt,ft=(h(vt,pt=j),vt.prototype.toObject=function(t){return new lt(this,this.parent,t).getResourceObject()},vt.prototype.superToObject=function(t){return pt.prototype.toObject.call(this,t)},vt.prototype.copySourceFromParent=function(){for(var t in this.source=this.parent.source,this.relationships)this.relationships[t].source=this.parent.relationships[t].source},vt);function vt(t){var e=pt.call(this)||this;e.parent=r.cloneDeep(t),e.type=e.parent.type,delete e.relationships;var i=Object.keys(e.parent.relationships);return e.fill(e.parent.toObject({include:i})),e.copySourceFromParent(),e}var gt=function(o,s,a,c){return new(a=a||Promise)(function(t,e){function i(t){try{n(c.next(t))}catch(t){e(t)}}function r(t){try{n(c.throw(t))}catch(t){e(t)}}function n(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,r)}n((c=c.apply(o,s||[])).next())})},yt=(bt.prototype.register=function(){if(null===it.me)throw new Error("Error: you are trying register `"+this.type+"` before inject JsonapiCore somewhere, almost one time.");return it.me.registerService(this)},bt.prototype.newResource=function(){return this.new()},bt.prototype.newCollection=function(){return new x},bt.prototype.new=function(){var t=new this.resource;return t.type=this.type,this.getService(),t.reset(),t},bt.prototype.getPrePath=function(){return""},bt.prototype.getPath=function(){return this.path||this.type},bt.prototype.getClone=function(t,e){return void 0===e&&(e={}),this.get(t,e).pipe(c.map(function(t){return new ft(t)}))},bt.prototype.get=function(t,e){var i=this;void 0===e&&(e={}),e=Object.assign({},F.ParamsResource,e);var r=new y;r.applyParams(this,e),r.appendPath(t);var n=this.getOrCreateResource(t);n.setLoaded(!1);var o=new a.BehaviorSubject(n);return 0<Object.keys(e.fields||[]).length?this.getGetFromServer(r,n,o):G(n,e.ttl)&&function(t,e){if(0===e.length)return 1;for(var i in t.relationships)if(e.includes(i)&&!t.relationships[i].builded)return 0;return 1}(n,e.include||[])?(n.setLoaded(!0),setTimeout(function(){return o.complete()},0)):0===n.cache_last_update?this.getGetFromLocal(e,r,n).then(function(){o.next(n),setTimeout(function(){return o.complete()},0)}).catch(function(){n.setLoaded(!1),i.getGetFromServer(r,n,o)}):this.getGetFromServer(r,n,o),o.asObservable()},bt.prototype.getGetFromLocal=function(i,r,n){return void 0===i&&(i={}),gt(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:if(!it.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),[4,(new W).getResource(W.getResourceKey(n),r.includes)];case 1:if(e=t.sent(),n.fill(e),n.setSource("store"),G(n,i.ttl))return n.setLoadedAndPropagate(!0),[2];throw new Error("Resource is dead!")}})})},bt.prototype.getGetFromServer=function(e,i,r){it.get(e.get()).subscribe(function(t){i.fill(t),i.cache_last_update=Date.now(),i.setLoadedAndPropagate(!0),i.setSourceAndPropagate("server"),it.injectedServices.rsJsonapiConfig.cachestore_support&&(new W).saveResource(i,e.includes),r.next(i),setTimeout(function(){return r.complete()},0)},function(t){i.setLoadedAndPropagate(!0),r.next(i),r.error(t)})},bt.prototype.getService=function(){return m.getService(this.type)||this.register()},bt.prototype.getOrCreateCollection=function(t){var e=this.getService(),i=I.getInstance().getOrCreateCollection(t.getForCache());return i.ttl=e.collections_ttl,"new"!==i.source&&(i.source="memory"),i},bt.prototype.getOrCreateResource=function(t){var e,i=m.getServiceOrFail(this.type);return null===(e=I.getInstance().getResource(this.type,t))&&((e=i.new()).id=t,I.getInstance().setResource(e,!1)),"new"!==e.source&&(e.source="memory"),e},bt.prototype.createResource=function(t){var e=m.getServiceOrFail(this.type).new();return e.id=t,I.getInstance().setResource(e,!1),e},bt.prototype.clearCacheMemory=function(){return gt(this,void 0,void 0,function(){return p(this,function(t){return[2,this.clearCache()]})})},bt.prototype.clearCache=function(){return gt(this,void 0,void 0,function(){var e;return p(this,function(t){return(e=new y).applyParams(this),I.getInstance().deprecateCollections(e.getForCache()),[2,(new W).deprecateCollection(e.getForCache()).then(function(){return!0})]})})},bt.prototype.parseToServer=function(t){},bt.prototype.parseFromServer=function(t){},bt.prototype.delete=function(e,t){var i=this;t=Object.assign({},F.ParamsResource,t);var r=new y;r.applyParams(this,t),r.appendPath(e);var n=new a.Subject;return it.delete(r.get()).subscribe(function(t){I.getInstance().removeResource(i.type,e),n.next(),n.complete()},function(t){n.error(t)}),n.asObservable()},bt.prototype.all=function(t){var e=this;void 0===t&&(t={});var i=Object.assign({},F.ParamsCollection,t);i.ttl||0===i.ttl||(i.ttl=this.collections_ttl);var r=new ut;r.applyParams(this,i);var n=this.getOrCreateCollection(r);n.page.number=1*i.page.number;var o=new a.BehaviorSubject(n);return 0<Object.keys(i.fields).length?this.getAllFromServer(r,i,n,o):G(n,i.ttl)?setTimeout(function(){return o.complete()},0):0===n.cache_last_update?(n.source="new",this.getAllFromLocal(i,r,n).then(function(){o.next(n),setTimeout(function(){o.complete()},0)}).catch(function(){n.setLoaded(!1),e.getAllFromServer(r,i,n,o)})):this.getAllFromServer(r,i,n,o),o.asObservable()},bt.prototype.getAllFromLocal=function(i,r,n){return void 0===i&&(i={}),gt(this,void 0,void 0,function(){var e;return p(this,function(t){switch(t.label){case 0:if(!it.injectedServices.rsJsonapiConfig.cachestore_support)throw new Error("We cant handle this request");return n.setLoaded(!1),"compact"!==i.store_cache_method?[3,2]:[4,it.injectedServices.JsonapiStoreService.getDataObject("collection",r.getForCache()+".compact")];case 1:return e=t.sent(),[3,4];case 2:return[4,(new W).getCollection(r.getForCache(),r.includes)];case 3:e=t.sent(),t.label=4;case 4:if(n.fill(e),n.setSourceAndPropagate("store"),G(n,i.ttl))return n.setLoadedAndPropagate(!0),n.setBuildedAndPropagate(!0),[2];throw new Error("Collection is dead!")}})})},bt.prototype.getAllFromServer=function(r,n,o,s){o.setLoaded(!1),it.get(r.get()).subscribe(function(t){if(n.cachehash)for(var e in t.data){var i=t.data[e];i.id=i.id+n.cachehash}o.fill(t),o.cache_last_update=Date.now(),o.setCacheLastUpdateAndPropagate(),o.setSourceAndPropagate("server"),o.setLoadedAndPropagate(!0),(new W).saveCollection(r.getForCache(),o,r.includes),it.injectedServices.rsJsonapiConfig.cachestore_support&&"compact"===n.store_cache_method&&it.injectedServices.JsonapiStoreService.saveCollection(r.getForCache()+".compact",t),s.next(o),setTimeout(function(){return s.complete()},0)},function(t){o.setLoadedAndPropagate(!0),s.next(o),s.error(t)})},bt);function bt(){var t=this;this.resource=j,setTimeout(function(){return t.register()})}var mt,_t=(h(wt,mt=j),wt);function wt(){var t=mt.call(this)||this;return t.attributes={name:"",date_of_birth:new Date,date_of_death:new Date,created_at:new Date,updated_at:new Date},t.relationships={books:new x,photos:new x},t.type="authors",t.ttl=0,!wt.test_ttl&&0!==wt.test_ttl||(t.ttl=wt.test_ttl),t}var Rt,jt=(h(St,Rt=yt),St);function St(){var t=Rt.call(this)||this;return t.resource=_t,t.type="authors",t.collections_ttl=0,t.register(),t}var Ot,Ct=(h(Pt,Ot=j),Pt);function Pt(){var t=Ot.call(this)||this;return t.attributes={date_published:new Date,title:"",created_at:new Date,updated_at:new Date},t.relationships={author:new q,photos:new x},t.type="books",t.ttl=0,!Pt.test_ttl&&0!==Pt.test_ttl||(t.ttl=Pt.test_ttl),t}var Dt,Et=(h(xt,Dt=yt),xt);function xt(){var t=Dt.call(this)||this;return t.type="books",t.resource=Ct,t.collections_ttl=0,t.register(),t}var At,Ft=(h(kt,At=j),kt);function kt(){var t=At.call(this)||this;return t.attributes={title:"",uri:"",imageable_id:"",created_at:new Date,updated_at:new Date},t.type="photos",t.ttl=0,!kt.test_ttl&&0!==kt.test_ttl||(t.ttl=kt.test_ttl),t}var It,Lt=(h(Tt,It=yt),Tt);function Tt(){var t=It.call(this)||this;return t.resource=Ft,t.type="photos",t.register(),t}var qt=(Jt.getResourceDocumentData=function(t,e,i){void 0===e&&(e=[]);var r=this["get"+t.name](i,e).toObject();return Jt.fillDocumentDataIncludedRelatioships(r,e),r},Jt.getCollectionDocumentData=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);var r=this.getCollection(t,e,i).toObject();return Jt.fillDocumentDataIncludedRelatioships(r,i),r},Jt.getBookDocumentData=function(){},Jt.getPhotoDocumentData=function(){},Jt.getBook=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new Ct;return r.id=this.getId(t),r.ttl=i,Jt.fillBookAttributes(r),r.relationships.author.data=this.getDataResourceWithType("authors"),e.includes("author")&&this.includeFromService(r,"author",_t),r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",Ft),r},Jt.getAuthor=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new _t;if(r.id=this.getId(t),r.ttl=i,Jt.fillAuthorAttributes(r),r.relationships.books.data=r.relationships.books.data.concat(this.getDataResourcesWithType("books",2)),e.includes("books")){this.includeFromService(r,"books",Ct);for(var n=0,o=r.relationships.books.data;n<o.length;n++)o[n].relationships.author.data.id=r.id}return r.relationships.photos.data=r.relationships.photos.data.concat(this.getDataResourcesWithType("photos",2)),e.includes("photos")&&this.includeFromService(r,"photos",Ft),r},Jt.getPhoto=function(t,e,i){void 0===e&&(e=[]),void 0===i&&(i=0);var r=new Ft;return r.id=this.getId(t),r.ttl=i,Jt.fillPhotoAttirbutes(r),r},Jt.getCollection=function(t,e,i){void 0===e&&(e=2),void 0===i&&(i=[]);for(var r=new x,n=0;n<e;n++){var o=this["get"+t.name](void 0,i);r.data.push(o)}return r.setBuilded(!0),r.setLoaded(!0),r.cache_last_update=Date.now(),r},Jt.fillAuthorAttributes=function(t){return t.attributes.name=d.name.firstName(),t.attributes.date_of_birth=d.date.past(),t.attributes.date_of_death=d.date.past(),t.attributes.created_at=d.date.past(),t.attributes.updated_at=d.date.past(),t},Jt.fillBookAttributes=function(t){return t.attributes.title=d.name.title(),t.attributes.date_published=d.date.past(),t.attributes.created_at=d.date.past(),t.attributes.updated_at=d.date.past(),t},Jt.fillPhotoAttirbutes=function(t){return t.attributes.title=d.name.title(),t.attributes.uri=d.internet.url(),t.attributes.imageable_id=d.random.uuid(),t.attributes.created_at=d.date.past(),t.attributes.updated_at=d.date.past(),t},Jt.getId=function(t){return t||"new_"+Math.floor(1e4*Math.random()).toString()},Jt.includeFromService=function(t,e,i){var r=t.relationships[e];r?r.data&&"id"in r.data?this.includeHasOneFromService(t,e,i):r instanceof x&&this.includeHasManyFromService(t,e,i):console.error(e+" relationship doesn't exist in "+t.type)},Jt.includeHasOneFromService=function(t,e,i){var r=new i,n=t.relationships[e];n&&n.data&&(r.id=n.data.id,Jt["fill"+i.name+"Attributes"](r),t.addRelationship(r,e))},Jt.includeHasManyFromService=function(t,e,i){for(var r=[],n=0,o=t.relationships[e].data;n<o.length;n++){var s=o[n],a=new i;a.id=s.id,Jt["fill"+i.name+"Attributes"](a),r.push(a)}t.relationships[e].data=r},Jt.getDataResourceWithType=function(t,e){return{id:this.getId(e),type:t}},Jt.getDataResourcesWithType=function(t,e){for(var i=[],r=0;r<e;r++)i.push(this.getDataResourceWithType(t));return i},Jt.fillResourceRelationshipsInDocumentData=function(t,e,i){t.included||(t.included=[]);var r=e.relationships[i];if(r instanceof q||"type"in r.data){var n=r.data;if(!n)return void console.warn("relationship content is empty");var o=Jt.resource_classes_by_type[n.type];if(!o)return void console.warn("cannot find the required class for type "+n.type);t.included.push(this["get"+o.name](n.id))}else if(r instanceof x||r.data instanceof Array)for(var s=0,a=e.relationships[i].data;s<a.length;s++){var c=a[s];t.included.push(this["get"+Jt.resource_classes_by_type[c.type].name](c.id))}},Jt.fillDocumentDataIncludedRelatioships=function(t,e){for(var i=0,r=e;i<r.length;i++){var n=r[i];if(t.included||(t.included=[]),t.data.id){if(!t.data.relationships[n].data)continue;return void Jt.fillResourceRelationshipsInDocumentData(t,t.data,n)}for(var o=0,s=t.data;o<s.length;o++){var a=s[o];Jt.fillResourceRelationshipsInDocumentData(t,a,n)}}},Jt);function Jt(){}qt.resource_classes_by_type={photos:Ft,books:Ct,authors:_t},t.Autoregister=function(){return function(t){}},t.JsonapiCore=it,t.Resource=j,t.DocumentResource=q,t.DocumentCollection=x,t.Service=yt,t.Author=_t,t.AuthorsService=jt,t.Book=Ct,t.BooksService=Et,t.Photo=Ft,t.PhotosService=Lt,t.TestFactory=qt,t.NgxJsonapiModule=nt,t.ɵe=O,t.ɵa=P,t.ɵb=N,t.ɵd=V,t.ɵc=Y,Object.defineProperty(t,"__esModule",{value:!0})});